<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="../Img/vtlogo.png" />
    <title>Quản lý danh mục | Van Thang Media</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="../assets/auth-guard.js"></script>

    <style>
      .sidebar {
        /* z-index cao để luôn nằm trên cùng */
        z-index: 50;
        transition: transform 0.3s ease-in-out;
      }
      .content-area {
        transition: margin-left 0.3s ease-in-out;
      }

      /* CSS cho màn hình mobile */
      @media (max-width: 768px) {
        .sidebar {
          /* Mặc định ẩn sidebar ra ngoài màn hình bên trái */
          transform: translateX(-100%);
        }
        .sidebar.active {
          /* Khi có class active, trượt sidebar vào trong màn hình */
          transform: translateX(0);
        }
        .content-area {
          /* Trên mobile, content luôn chiếm toàn bộ chiều rộng */
          margin-left: 0 !important;
        }
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
      <!-- Sidebar (same as index.html) -->
      <div
        class="sidebar bg-white w-64 md:w-20 lg:w-64 fixed h-full shadow-md z-50"
      >
        <div
          class="flex items-center justify-center h-16 border-b border-gray-200"
        >
          <div class="text-blue-600 font-bold text-xl lg:block hidden">
            VanThangMedia
          </div>
          <div
            class="text-blue-600 font-bold text-xl lg:hidden md:block hidden"
          >
            TTM
          </div>
        </div>
        <nav class="mt-4">
          <div class="px-4">
            <div
              class="text-gray-500 uppercase text-xs font-semibold tracking-wider lg:block hidden"
            >
              Main
            </div>
            <a
              href="./admin.html"
              class="flex items-center mt-3 py-2 px-4 hover:bg-blue-50 hover:text-blue-600 rounded-lg"
            >
              <i data-feather="home" class="w-5 h-5"></i>
              <span class="ml-3 lg:block md:hidden">Dashboard</span>
            </a>
            <a
              href="./posts.html"
              class="flex items-center mt-3 py-2 px-4 hover:bg-blue-50 hover:text-blue-600 rounded-lg"
            >
              <i data-feather="file-text" class="w-5 h-5"></i>
              <span class="ml-3 lg:block md:hidden">Bài viết</span>
            </a>
            <a
              href="./categories.html"
              class="flex items-center mt-3 py-2 px-4 bg-blue-50 text-blue-600 rounded-lg"
            >
              <i data-feather="folder" class="w-5 h-5"></i>
              <span class="ml-3 lg:block md:hidden">Danh mục</span>
            </a>
            <a
              href="./comments.html"
              class="flex items-center mt-3 py-2 px-4 hover:bg-blue-50 hover:text-blue-600 rounded-lg"
            >
              <i data-feather="message-square" class="w-5 h-5"></i>
              <span class="ml-3 lg:block md:hidden">Bình luận</span>
            </a>
          </div>
          <div class="px-4 mt-8">
            <div
              class="text-gray-500 uppercase text-xs font-semibold tracking-wider lg:block hidden"
            >
              User
            </div>
            <a
              href="#"
              class="flex items-center mt-3 py-2 px-4 hover:bg-blue-50 hover:text-blue-600 rounded-lg"
            >
              <i data-feather="users" class="w-5 h-5"></i>
              <span class="ml-3 lg:block md:hidden">Tài khoản</span>
            </a>
            <a
              href="#"
              class="flex items-center mt-3 py-2 px-4 hover:bg-blue-50 hover:text-blue-600 rounded-lg"
            >
              <i data-feather="settings" class="w-5 h-5"></i>
              <span class="ml-3 lg:block md:hidden">Cài đặt</span>
            </a>
          </div>
        </nav>
      </div>
      <div
        id="sidebar-overlay"
        class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden"
      ></div>
      <!-- Main Content -->
      <div
        class="content-area flex-1 flex flex-col overflow-hidden ml-0 md:ml-20 lg:ml-64"
      >
        <!-- Top Header (same as index.html) -->
        <header class="bg-white shadow-sm">
          <div class="flex items-center justify-between px-6 py-3">
            <div class="flex items-center">
              <button
                id="sidebarToggle"
                class="text-gray-500 focus:outline-none lg:hidden"
              >
                <i data-feather="menu" class="w-6 h-6"></i>
              </button>
              <!-- <div class="relative mx-4 lg:block hidden">
                <input
                  type="text"
                  class="w-64 pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  placeholder="Tìm kiếm..."
                />
                <i
                  data-feather="search"
                  class="absolute left-3 top-2.5 text-gray-400"
                ></i>
              </div> -->
            </div>
            <div class="flex items-center space-x-4">
              <button class="text-gray-500 focus:outline-none relative">
                <i data-feather="bell" class="w-6 h-6"></i>
                <span
                  class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500"
                ></span>
              </button>
              <div class="dropdown relative">
                <button class="flex items-center focus:outline-none">
                  <img
                    src="../Img/AnhFB/anhavata2 (2).jpg"
                    class="w-8 h-8 rounded-full"
                    alt="User"
                  />
                  <span class="ml-2 text-gray-700 font-medium lg:block hidden"
                    >Admin</span
                  >
                  <!-- <i
                    data-feather="chevron-down"
                    class="ml-1 w-4 h-4 text-gray-500 lg:block hidden"
                  ></i> -->
                </button>
                <div
                  class="dropdown-menu absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50 transition ease-out duration-100 transform opacity-0 scale-95 pointer-events-none"
                >
                  <a
                    href="#"
                    class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600"
                    >Hồ sơ cá nhân</a
                  >
                  <a
                    href="#"
                    class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600"
                    >Đổi mật khẩu</a
                  >
                  <div class="border-t border-gray-200"></div>
                  <a
                    href="#"
                    id="logout-btn"
                    class="block px-4 py-2 text-gray-700 hover:bg-blue-50 hover:text-blue-600"
                    >Đăng xuất</a
                  >
                </div>
              </div>
            </div>
          </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto p-6 bg-gray-50">
          <div class="mb-6 flex items-center justify-between">
            <h1 class="text-2xl font-bold text-gray-800">Quản lý danh mục</h1>
            <button
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center"
              onclick="openAddCategoryModal()"
            >
              <i data-feather="plus" class="w-4 h-4 mr-2"></i>
              Thêm danh mục
            </button>
          </div>

          <!-- Categories Table -->
          <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                  <tr>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Tên danh mục
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Slug
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Số bài viết
                    </th>
                    <th
                      class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                    >
                      Hành động
                    </th>
                  </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                  <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm font-medium text-gray-900">
                        Công nghệ
                      </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm text-gray-500">cong-nghe</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                      <div class="text-sm text-gray-500">42</div>
                    </td>
                    <td
                      class="px-6 py-4 whitespace-nowrap text-sm text-gray-500"
                    >
                      <div class="flex space-x-2">
                        <button
                          class="text-blue-600 hover:text-blue-900"
                          onclick="openEditCategoryModal()"
                        >
                          <i data-feather="edit" class="w-4 h-4"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-900">
                          <i data-feather="trash-2" class="w-4 h-4"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                  <!-- More rows... -->
                </tbody>
              </table>
            </div>
            <div
              class="px-6 py-4 border-t border-gray-200 flex items-center justify-between"
            >
              <div class="text-sm text-gray-500">
                Hiển thị <span class="font-medium">1</span> đến
                <span class="font-medium">10</span> của
                <span class="font-medium">24</span> kết quả
              </div>
              <div class="flex space-x-2">
                <button
                  class="px-3 py-1 rounded-md border border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                >
                  Trước
                </button>
                <button
                  class="px-3 py-1 rounded-md border border-gray-300 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700"
                >
                  1
                </button>
                <button
                  class="px-3 py-1 rounded-md border border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                >
                  2
                </button>
                <button
                  class="px-3 py-1 rounded-md border border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                >
                  3
                </button>
                <button
                  class="px-3 py-1 rounded-md border border-gray-300 text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                >
                  Sau
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Add Category Modal -->
    <div
      id="addCategoryModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"
    >
      <div
        class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
      >
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-lg font-medium text-gray-900">Thêm danh mục mới</h3>
          <button
            onclick="closeAddCategoryModal()"
            class="text-gray-400 hover:text-gray-500"
          >
            <i data-feather="x" class="w-6 h-6"></i>
          </button>
        </div>
        <div class="mt-2">
          <div class="mb-4">
            <label
              for="categoryName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Tên danh mục</label
            >
            <input
              type="text"
              id="categoryName"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="Nhập tên danh mục"
            />
          </div>
          <div class="mb-4">
            <label
              for="categorySlug"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Đường dẫn (Slug)</label
            >
            <input
              type="text"
              id="categorySlug"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
              placeholder="duong-dan-danh-muc"
            />
          </div>
          <div class="mb-4">
            <label
              for="categoryParent"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Danh mục cha</label
            >
            <select
              id="categoryParent"
              class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            >
              <option value="">Không có</option>
              <option>Công nghệ</option>
              <option>Kinh doanh</option>
            </select>
          </div>
        </div>
        <div class="flex justify-end space-x-3 mt-4">
          <button
            onclick="closeAddCategoryModal()"
            class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300"
          >
            Hủy
          </button>
          <button
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
          >
            Lưu
          </button>
        </div>
      </div>
    </div>

    <script>
      feather.replace();

      const dropdownButton = document.querySelector(".dropdown button");
      const dropdownMenu = document.querySelector(".dropdown-menu");
      const dropdownIcon = document.getElementById("dropdown-icon"); // [MỚI] Lấy ra thẻ icon

      // Các lớp định nghĩa trạng thái "hiện" của menu
      const activeClasses = ["opacity-100", "scale-100", "pointer-events-auto"];
      // Các lớp định nghĩa trạng thái "ẩn" của menu
      const inactiveClasses = ["opacity-0", "scale-95", "pointer-events-none"];

      // 2. Thêm sự kiện "click" cho nút dropdown
      dropdownButton.addEventListener("click", function (event) {
        event.stopPropagation();
        const isHidden = dropdownMenu.classList.contains("opacity-0");

        if (isHidden) {
          console.log(isHidden);
          // Nếu đang ẩn -> Hiện nó ra
          dropdownMenu.classList.remove(...inactiveClasses);
          dropdownMenu.classList.add(...activeClasses);
          // [MỚI] Đổi icon thành "up"
          dropdownIcon.setAttribute("data-feather", "chevron-up");
        } else {
          console.log(isHidden);
          // Nếu đang hiện -> Ẩn nó đi
          dropdownMenu.classList.remove(...activeClasses);
          dropdownMenu.classList.add(...inactiveClasses);
          // [MỚI] Đổi icon thành "down"
          dropdownIcon.setAttribute("data-feather", "chevron-down");
        }
        // [MỚI] Yêu cầu Feather Icons vẽ lại icon vừa được thay đổi
        feather.replace();
      });

      const logoutBtn = document.getElementById("logout-btn");

      if (logoutBtn) {
        logoutBtn.addEventListener("click", (e) => {
          e.preventDefault(); // Ngăn thẻ <a> chuyển trang mặc định

          // 1. Xóa token khỏi bộ nhớ trình duyệt
          localStorage.removeItem("authToken");

          // 2. Chuyển hướng người dùng về trang đăng nhập
          // Đảm bảo đường dẫn này chính xác so với vị trí file categories.html của bạn
          window.location.href = "./login.html";
        });
      }

      // 3. Đóng dropdown khi nhấp ra bên ngoài
      window.addEventListener("click", function () {
        event.stopPropagation();
        if (dropdownMenu.classList.contains("opacity-100")) {
          dropdownMenu.classList.remove(...activeClasses);
          dropdownMenu.classList.add(...inactiveClasses);
          // [MỚI] Đổi icon về "down" khi đóng menu
          dropdownIcon.setAttribute("data-feather", "chevron-down");
          // [MỚI] Yêu cầu Feather Icons vẽ lại
          feather.replace();
        }
      });

      // Sidebar Toggle
      const sidebar = document.querySelector(".sidebar");
      const sidebarOverlay = document.getElementById("sidebar-overlay");
      const sidebarToggle = document.getElementById("sidebarToggle"); // Giả sử nút toggle của bạn có id="sidebarToggle"

      function openSidebar() {
        if (sidebar && sidebarOverlay) {
          sidebar.classList.add("active");
          sidebarOverlay.classList.remove("hidden");
        }
      }

      function closeSidebar() {
        if (sidebar && sidebarOverlay) {
          sidebar.classList.remove("active");
          sidebarOverlay.classList.add("hidden");
        }
      }

      // 1. Nhấn vào nút toggle để mở/đóng
      if (sidebarToggle) {
        sidebarToggle.addEventListener("click", (e) => {
          e.stopPropagation(); // Ngăn sự kiện click lan ra ngoài
          if (sidebar.classList.contains("active")) {
            closeSidebar();
          } else {
            openSidebar();
          }
        });
      }

      // 2. Nhấn vào lớp overlay để đóng
      if (sidebarOverlay) {
        sidebarOverlay.addEventListener("click", () => {
          closeSidebar();
        });
      }

      // 3. (Tùy chọn) Nhấn phím Escape để đóng
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && sidebar.classList.contains("active")) {
          closeSidebar();
        }
      });

      // document
      //   .getElementById("sidebarToggle")
      //   .addEventListener("click", function () {
      //     document.querySelector(".sidebar").classList.toggle("active");
      //   });

      // Responsive sidebar behavior
      function handleSidebar() {
        const sidebar = document.querySelector(".sidebar");
        const content = document.querySelector(".content-area");

        if (window.innerWidth < 768) {
          sidebar.classList.remove("active");
        } else if (window.innerWidth < 1024) {
          sidebar.classList.add("active");
        } else {
          sidebar.classList.remove("active");
        }
      }

      // Category Modal Functions
      function openAddCategoryModal() {
        document.getElementById("addCategoryModal").classList.remove("hidden");
      }

      function closeAddCategoryModal() {
        document.getElementById("addCategoryModal").classList.add("hidden");
      }

      function openEditCategoryModal() {
        // Similar to openAddCategoryModal but populate with existing data
        openAddCategoryModal();
      }

      window.addEventListener("resize", handleSidebar);
      handleSidebar();
    </script>
  </body>
</html>
